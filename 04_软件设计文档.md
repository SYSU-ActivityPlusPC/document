# 软件设计文档
**小组成员：肖雨蓓，唐玄昭，吴雪敏，朱理锋，李佳仕**

## 总体设计 预备
### 设计流程--从关键模型一步步设计 预备

用例图/DomainModel图/ER图/架构图

### 总体架构 预备
总体架构模式描述及使用理由...
总体思想...
架构图...

总体上使用了MCV的软件架构模式和RESTful架构风格，同时为了降低耦合以及减少编码工作之间的相互牵制，我们的项目使用了前后端分离的思想，前后端通过遵循API的设计分别进行工作，因此只需要保证API文档的准确性和实时更新，那么前端和后端便能够相互独立地进行编码工作，从而有效地促进工作效率。

客户通过与前端页面进行交互，前端根据用户的操作通过ajax技术异步发送HTTP请求给后端，后端接收请求后，通过路由分发到不同的controller进行处理，ORM框架将后端对象与数据库关系进行一一映射，后端controller操作model进行数据的改变，请求经过处理后，后端最后生成响应发送给前端，前端得到HTTP响应后，通过解析和浏览器渲染，将结果呈现给用户。

在这整个过程中后端给前端提供RESTful接口服务，同时我们*建立了***服务器作为中间层，通过HTTP代理来实现前后端的分离。*在后端controller和数据库model之间，我们使用了ORM框架（对象关系映射框架），从而简化了对数据库进行的增删改查等等操作，让我们可以以处理对象的方式来间接操作数据库。

其中在前端我们使用的是Vue框架，...，在后端我们使用的是Go语言，在Go中的许多开源包（*...*）的辅助下实现了我们的web服务器，同时我们使用了MySQL数据库。

由于我们采用了前后端分离的思想，因此我们将项目划分为了两个子仓库：service-end和front-end，让前端和后端工程师分别管理自己的项目，进行开发工作。因此，我们接下来分别从前端和后端方面介绍技术选型，架构设计，模块划分以及使用到的软件设计技术。


### API设计 预备
我们的API设计是遵循RESTful API的风格，并且使用apiary.io平台实现API的共享协作和测试，我们根据API处理的资源不同对其进行了模块的划分：

API不同模块截图如下...

## 前端
### 技术选型及理由 朱理锋

本项目前端的技术栈为vue全家桶（vue + vue-router + iview ）+ axios + webpack

- vue： 当下最火最容易上手的MVVM框架
- vue-router: 前端路由
- axios：很强大很好上手的ajax请求库
- ivew: 一款vue的ui框架，精美好看
- webpack：打包工具

选vue的理由：

vue是国人开发的一款MVVM框架。它的特点是轻量 ，好上手 。考虑到前端开发同学的技术栈参差不齐，所以统一选用vue来作为开发框架，因为它好上手，学习的曲线是很平滑的，不像react和angular这类MVVM框架学习成本较高。其次就是轻量，vue的作者给广大开发者提供了一个脚手架工具，能够一键生成项目，生成的项目里有vuex，有vue-router，也有eslint这类工具，做到了开箱即用。对比react，react的比较出名的脚手架工具没有vue-cli这么方便，它还得自己根据需求去添加别的第三方插件，而且添加的成本略高，需要去看英文文档和写一些引入代码。综合对比react和angular在这两点上的不同，最后选择了vue。



vue-router：

vue-router是配套vue的一个单页面路由的插件。单页面与传统的网页最大不一样的地方就是，传统网页的路由是有后台去控制的，而单页面网页的路由是放在前台的，在前台中控制。故vue-router是必选的



axios：

选用的原因很简单，就是简单和强大。简单在于可以一行代码就发起一个http请求，支持promise，所以也就可以使用async await来以同步的形式写异步的代码。

强大在于提供了拦截器等功能。方便我们在发起请求前在header增加token，以及在收到回复中，分析结果，统一处理错误。



iview：

一款相对其他vue的ui框架比较好的ui框架。而且还比较好看，故选用。



webpack:

webpack 是当下前端最流行的构建打包工具，利用 webpack 搭配相应的 loader，我们可以在前端项目中使用 es6 进行开发，效率更高。开发完成后，webpack 还可以帮我们完成构建，将代码编译到 es5 以兼容大部分浏览器。webpack 优化了构建打包的算法，优化前端的模块加载，使得构建打包后的产品代码体积更小。


### 架构设计 朱理锋
前端项目主要是页面样式开发，交互逻辑开发以及开发完后的部署。可分为开发环境和生产环境。而开发环境和生产环境都需要webpack来构建。webpack构建首先需要源代码，其次webpack是配置大于约定的，需要我们写配置文件去告诉它从哪个入口文件开始打包，打包哪种文件，如何打包等等，打包后还会生成一个可用于我们部署到服务器的文件。另外，由于前后端现在是分离的。前后端开发环境不一样，肯定会出现跨域等情况，又或者开发时，热更新可以帮助我们减少重复的操作等等，所以又需要额外的配置文件。故综合以上的分析，我们需要以下4个包

- build：根据config和执行环境来打包构建src中的代码，使其可运行，可调试
- config：项目的webpack打包配置、http代理配置
- src: 源码，平时开发写的代码都在这里
- dist：项目打包后生成的可部署文件
![image](https://user-images.githubusercontent.com/23744602/42043050-0fad3de6-7b28-11e8-8547-c8d5e7e12da4.png)


上面也说到我们的源码都在src里面。而一个可维护和可扩展的代码是需要做好文件架构的。根据单一职责原则，我们可以先把代码分割成 assets，router，utils，style和页面的UI和逻辑代码五个部分。assets主要放一些资源，比如icon和图片。router主要放前端的路由配置，这里指明了前端的页面的路由路径以及对应的组件。style放了一些全局的样式和动画的样式，由于浏览器默认的标签样式不统一，为了让我们的网页在各个页面展示的效果一致，我们需要一个reset.css来统一标签的样式，也由于我们会用到一些比较好看的动画效果，有时候自己写比较麻烦，而已经有人做好了轮子，我们直接拿来用就是了，比如我们这次引用的animate.css。utils就放了全局通用的方法，需要用到的话引入即可，不需要每个组件都写一份。至于最后的页面UI和逻辑代码。我们这里采用了组件开发的思想，每个页面抽象为一个有很多组件组合而成的。我们需要把可复用的页面UI和逻辑抽象成为一个组件。那需要用到的页面直接使用就好。这样的思想，给我们带来了高复用，高内聚，低耦合的好处。故这部分又可以分为 components和pages两个部分。components就是可复用的组件。pages就是组装这些组件的代码。而且根据页面来命名文件，协作者一看到文件名就知道对应哪个页面，这样也提高了效率。

- components：可复用组件
- pages: 页面组件
- utils：公共工具函数
- style：公共样式、重置样式和动画样式
- assets：图标、图片等静态资源
- router：前端路由
  
![image](https://user-images.githubusercontent.com/23744602/42075706-c2bad318-7ba4-11e8-9b6f-f77483f0a1ea.png)

### 模块划分 李佳仕
参见
https://github.com/SYSUMonkeyEye/MonkeyEye-Doc/blob/master/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3.md

### 软件设计技术 李佳仕
列出项目中使用的软件设计技术，包括但不限于：
Structure ProgrammingObject-Oriented Programming
Aspect-Oriented ProgrammingService Oriented
ArchitectureDesign Patterns中的种种技术，并且对于每种技术，**要给出其在源代码中出现的位置，指明对应模块和代码**

## 后端
### 技术选型及理由 唐玄昭
后端的技术栈为nginx+golang+mysql
golang是一门编程语言，其内置了web支持，其优势在于性能高，学习周期短，开发成本低，专一化，轻量化，考虑到各种语言的熟悉程度和部署成本，我们决定使用golang作为我们的后台开发语言

Nginx 是一个高性能的负载均衡服务器，支持负载均衡；能够快速灵活且可靠的传送静态文件，同时能保证网站在面对恶意流量的攻击中能正常运行，从而保护应用安全。该项目使用nginx作为反向代理工具，使得后台的编码无需考虑繁复的路径问题，同时提供给后台良好的可扩展性。

MySQL 是目前最流行的关系型数据库管理系统，被广泛地应用在 Internet 上的中小型网站中，它具有体积小、速度快、总体拥有成本低，且其免费开源。此次开发使用关系型数据库作为用户信息和活动信息的存储载体。

### 架构设计 预备
后端架构模式+实际...
数据库设计...

在我们的项目中，API设计和数据库设计主要由后端进行设计决定，API设计在总体设计中已经描述，数据库设计在之后会说明。其次后端架构设计主要包括后端架构选择和后端框架选择，其中后端框架的选择在技术选型及理由中已经列出，因此在这里，我们将结合我们项目的实际描述一下我们选择的架构模式，其次说明一下我们的数据库设计：


#### 数据库设计 预备
我们在总体架构中，一步一步从用例图设计到ER图，其实就已经得到了我们的数据库表和之间的关系，下面是我们的数据库图：

... 

说明一下数据库图和之间的关系...以及这样设计的好处...

### 模块划分 预备
组件包图...模块之间相关关联图...

后端开发主要包括API的开发以及权限访问控制等功能的实现，因此我们后端可以划分为路由器模块，API模块(controller)，数据模块(model)，中间件模块，类型处理模块；其中API模块根据各个接口的功能又可以划分为活动报名模块(actapply)，消息模块(message)，session模块，用户模块(pcuser)，图片模块(picture)，活动模块(activity)，因此可以看到模块划分十分清晰，便于管理和工作。

服务端目录结构如下：...


### 软件设计技术 唐玄昭

**OOP**：使用golang作为后台语言，利用领域模型建模，将需要用到的实体使用类的方式进行封装，并给予相应的属性和方法，以数据库对象Activity为例：

![属性值](picture/sdd-1.png)
![方法](picture/sdd-2.png)

以上两张图分别包含了Activity这么一个类所具有的属性值和方法，外部可以通过调用方法来实现对数据库的修改

**3-tier architecture**：考虑到扩展性和可维护性，我们将后台分成表示层-业务逻辑层-持久化层，分别负责请求信息的读取及返回值的封装、业务逻辑的处理、数据库等持久化对象的处理，三者各司其职，每一层只对上一层提供服务，同样的，每一层也只能调用其下一层的服务，从而降低了系统的耦合性；而业务逻辑层基本上只会使用一个数据库对象，因此达到了高内聚的要求；

![architecture](picture/sdd-4.png)

对于后台系统来说，系统不关心用户之前访问了什么，所有的请求信息都包括在了当前的请求之内，从而为系统的可扩展性带来了方便，从compose文件可以看到，后台系统之前存在一个nginx网关，负责请求的分发和静态文件的代理，因此考虑扩展性方面，只需要简单地多创建几个服务端容器实例即可，无需关注其他问题

![compose](picture/sdd-3.png)

**要给出其在源代码中出现的位置，指明对应模块和代码**
